<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title></title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />
<link rel="stylesheet" href="site_libs_extra/academicons-1.8.0/css/academicons.css"/>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
div.sourceCode {
  overflow-x: visible;
}
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}

.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home fa-1x"></span>
     
    Home
  </a>
</li>
<li>
  <a href="mapmaking.html">
    <span class="fa fa-map fa-1.5x"></span>
     
    Mapmaking
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-map-marker  fa-1x"></span>
     
    Spatial Data
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="spatial_XY.html">XY Data</a>
    </li>
    <li>
      <a href="spatial_linepoly.html">Polyline &amp; Polygons</a>
    </li>
    <li>
      <a href="spatial_kml.html">kml &amp; kmz</a>
    </li>
    <li>
      <a href="spatial_rasters.html">rasters</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-cog fa-1x"></span>
     
    Mapping Methods
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="maps_sf.html">Using sf</a>
    </li>
    <li>
      <a href="maps_tmap.html">tmap</a>
    </li>
    <li>
      <a href="maps_mapview.html">mapview</a>
    </li>
    <li>
      <a href="maps_leaflet.html">Leaflet</a>
    </li>
    <li>
      <a href="maps_hexbins.html">hexbins</a>
    </li>
  </ul>
</li>
<li>
  <a href="resources.html">
    <span class="fa fa-info-circle  fa-1x"></span>
     
    Resources
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="contact.html">
    <span class="fa fa-hand-spock-o"></span>
     
    Contact
  </a>
</li>
<li>
  <a href="https://github.com/ryanpeek/mapping_in_R">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>




</div>


<p><br></p>
<div id="line-and-polygon-data-with-rgdal-and-sf" class="section level1">
<h1>Line and Polygon Data with <code>rgdal</code> and <code>sf</code></h1>
<p>There are loads of spatial mapping/plotting packages in R. The main two ways to read in spatial data use the <code>rgdal</code> package, and the <code>sf</code> package. Let’s look at how to load/plot line and polygon data.</p>
<p><strong>Let’s load packages first:</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">suppressPackageStartupMessages</span>({
  <span class="kw">library</span>(rgdal); <span class="co"># spatial/shp reading</span>
  <span class="kw">library</span>(dplyr); <span class="co"># wrangling data/plotting</span>
  <span class="kw">library</span>(readr);
  <span class="kw">library</span>(viridis); <span class="co"># nice color palette</span>
  <span class="kw">library</span>(sf); <span class="co"># newer &quot;simple features&quot; spatial package</span>
  <span class="kw">library</span>(USAboundaries); <span class="co"># state/county data</span>
  <span class="kw">library</span>(Imap); <span class="co"># nice mapping/color functions</span>
  <span class="kw">library</span>(ggrepel) <span class="co"># for labeling</span>
  }) </code></pre></div>
<div id="linepolyline-shapefile-data" class="section level2">
<h2>Line/Polyline Shapefile Data</h2>
<p>For this example, let’s use some <a href="http://www.hydrosheds.org/">Hydroshed</a> Data.</p>
<p>I’ve downloaded rivers for CA and OR and put them <a href="https://github.com/ryanpeek/mapping_in_R/blob/master/data/rivs_CA_OR_hydroshed.zip">here</a> on github. Download the zipped file and unzip it in a <code>data</code> folder. We’re going to use <em><code>shapefiles</code></em> for the remainder of this example.</p>
<div id="load-shapefiles-with-rgdal" class="section level3">
<h3>Load shapefiles with <code>rgdal</code></h3>
<p>Let’s load a polyline or line shapefile of rivers of California and Oregon. The result is a <code>SpatialLinesDataFrame</code> in your R environment.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># we can use ogrInfo to see CRS, attributes, etc.</span>
<span class="kw">ogrInfo</span>(<span class="dt">dsn=</span><span class="st">&quot;./data&quot;</span>, <span class="dt">layer=</span><span class="st">&quot;rivs_CA_OR_hydroshed&quot;</span>) <span class="co"># see shapefile info</span></code></pre></div>
<pre><code>## Source: &quot;./data&quot;, layer: &quot;rivs_CA_OR_hydroshed&quot;
## Driver: ESRI Shapefile; number of rows: 21976 
## Feature type: wkbLineString with 2 dimensions
## Extent: (-124.5429 32.58542) - (-114.1315 46.26042)
## CRS: +proj=longlat +datum=WGS84 +no_defs  
## LDID: 87 
## Number of fields: 26 
##          name type length typeName
## 1       ARCID    0      9  Integer
## 2    UP_CELLS    2     24     Real
## 3     statefp    4     80   String
## 4     statens    4     80   String
## 5    affgeoid    4     80   String
## 6       geoid    4     80   String
## 7      stusps    4     80   String
## 8        name    4     80   String
## 9        lsad    4     80   String
## 10      aland    2     24     Real
## 11     awater    2     24     Real
## 12 state_name    4     80   String
## 13 state_abbr    4     80   String
## 14 jurisdicti    4     80   String
## 15  statefp.1    4     80   String
## 16  statens.1    4     80   String
## 17 affgeoid.1    4     80   String
## 18    geoid.1    4     80   String
## 19   stusps.1    4     80   String
## 20     name.1    4     80   String
## 21     lsad.1    4     80   String
## 22    aland.1    2     24     Real
## 23   awater.1    2     24     Real
## 24 state_na_1    4     80   String
## 25 state_ab_1    4     80   String
## 26 jurisdic_1    4     80   String</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># then read in the shapefile</span>
rivers_sp&lt;-<span class="st"> </span><span class="kw">readOGR</span>(<span class="dt">dsn =</span> <span class="st">&quot;data&quot;</span>, <span class="dt">layer =</span> <span class="st">&quot;rivs_CA_OR_hydroshed&quot;</span>)</code></pre></div>
<pre><code>## OGR data source with driver: ESRI Shapefile 
## Source: &quot;data&quot;, layer: &quot;rivs_CA_OR_hydroshed&quot;
## with 21976 features
## It has 26 fields</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">proj4string</span>(rivers_sp) <span class="co"># check projection, should be WGS84</span></code></pre></div>
<pre><code>## [1] &quot;+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0&quot;</code></pre>
</div>
<div id="load-shapefiles-with-sf" class="section level3">
<h3>Load shapefiles with <code>sf</code></h3>
<p>Here’s how to do the same thing using the <code>sf</code> package. Notice two important differences, the <code>sf</code> package reads things in as a regular dataframe, with the spatial component of the data contained inside a <code>geometry</code> <strong>list-column</strong> within the dataframe. That means you can operate on this data as you would any data frame. The other main difference, is that reading shape data in is much faster with <code>sf</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># notice the similar function structure, but results in dataframe</span>
rivers_sf &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="dt">dsn =</span> <span class="st">&quot;./data&quot;</span>, <span class="dt">layer=</span><span class="st">&quot;rivs_CA_OR_hydroshed&quot;</span>) </code></pre></div>
<pre><code>## Reading layer `rivs_CA_OR_hydroshed&#39; from data source `/Users/ryanpeek/Documents/github/teaching/mapping_in_R/data&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 21976 features and 26 fields
## geometry type:  MULTILINESTRING
## dimension:      XY
## bbox:           xmin: -124.5429 ymin: 32.58542 xmax: -114.1315 ymax: 46.26042
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># check crs</span>
<span class="kw">st_crs</span>(rivers_sf)</code></pre></div>
<pre><code>## Coordinate Reference System:
##   EPSG: 4326 
##   proj4string: &quot;+proj=longlat +datum=WGS84 +no_defs&quot;</code></pre>
</div>
</div>
<div id="polygon-shapefile-data" class="section level2">
<h2>Polygon Shapefile Data</h2>
<p>No different here, process is the same. But let’s take a look at a package that might be helpful for folks working with state/county boundaries.</p>
<div id="download-statecounty-data" class="section level3">
<h3>Download State/County Data</h3>
<p>A nice package for pulling county/state data is the <code>USAboundaries</code> package. Importantly, this package pulls these data in as <code>sf</code> features (<code>dataframes</code>), not as <code>rgdal</code> or <code>SpatialPolygonDataFrames</code> data.</p>
<p>Let’s show this in two steps, the first is how to grab a <code>sf</code> feature for a given state or states.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Pick a State</span>
state_names &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;california&quot;</span>)

<span class="co"># Download STATE data and add projection</span>
CA&lt;-<span class="kw">us_states</span>(<span class="dt">resolution =</span> <span class="st">&quot;high&quot;</span>, <span class="dt">states =</span> state_names) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">st_transform</span>(<span class="dt">crs =</span> <span class="dv">4326</span>)</code></pre></div>
<p>That was easy…what about counties? We can use the same type of call, but let’s add some <code>dplyr</code> and <code>purrr</code> functionality here to add the X and Y values for the centroid of each polygon (county) we download. In this case we use <code>map_dbl</code> because it will take a vector or values (the <code>geometry</code> col here), map a function over each row in that vector, and return a vector of values (the centroid points).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(purrr)</code></pre></div>
<pre><code>## 
## Attaching package: &#39;purrr&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:Imap&#39;:
## 
##     imap</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Pick some CA counties</span>
co_names &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Butte&quot;</span>, <span class="st">&quot;Placer&quot;</span>, <span class="st">&quot;El Dorado&quot;</span>, <span class="st">&quot;Nevada&quot;</span>, <span class="st">&quot;Yuba&quot;</span>, <span class="st">&quot;Sierra&quot;</span>, <span class="st">&quot;Plumas&quot;</span>)

<span class="co"># get COUNTY data for a given state</span>
counties_spec &lt;-<span class="st"> </span><span class="kw">us_counties</span>(<span class="dt">resolution =</span> <span class="st">&quot;low&quot;</span>, <span class="dt">states=</span>state_names) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># use list of state(s) here</span>
<span class="st">  </span><span class="kw">filter</span>(name <span class="op">%in%</span><span class="st"> </span>co_names) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># filter to just the counties we want</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lon=</span><span class="kw">map_dbl</span>(geometry, <span class="op">~</span><span class="kw">st_centroid</span>(.x)[[<span class="dv">1</span>]]), <span class="co"># add centroid values for labels</span>
         <span class="dt">lat=</span><span class="kw">map_dbl</span>(geometry, <span class="op">~</span><span class="kw">st_centroid</span>(.x)[[<span class="dv">2</span>]])) <span class="co"># add centroid values for labels</span>

<span class="co"># get range of lat/longs from counties for mapping</span>
mapRange1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">range</span>(<span class="kw">st_coordinates</span>(counties_spec)[,<span class="dv">1</span>]),<span class="kw">range</span>(<span class="kw">st_coordinates</span>(counties_spec)[,<span class="dv">2</span>]))</code></pre></div>
</div>
</div>
<div id="make-some-maps" class="section level2">
<h2>Make some Maps!</h2>
<p>First let’s show a few examples comparing how to plot with the <code>rgdal</code> rivers dataset vs. the <code>sf</code> version.</p>
<div id="base-rgdal-vs.-sf" class="section level3">
<h3>Base: <code>rgdal</code> vs. <code>sf</code></h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))
<span class="kw">plot</span>(rivers_sp, <span class="dt">col=</span><span class="st">&quot;blue&quot;</span>)
<span class="kw">title</span>(<span class="st">&quot;with sp&quot;</span>)
<span class="kw">plot</span>(<span class="kw">st_geometry</span>(rivers_sf), <span class="dt">col=</span><span class="st">&quot;darkblue&quot;</span>)
<span class="kw">title</span>(<span class="st">&quot;with sf&quot;</span>)</code></pre></div>
<p><img src="spatial_linepoly_files/figure-html/rgdal_base-1.png" width="672" /></p>
<p>Pretty much the same deal.</p>
</div>
</div>
<div id="advanced-mapping" class="section level2">
<h2>Advanced Mapping</h2>
<p>Okay, let’s add in the county/state data, and figure out a few tricks to making our map a bit cleaner.</p>
<div id="layering-maps-plot-and-sf" class="section level3">
<h3>Layering Maps: <code>plot</code> and <code>sf</code></h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)) <span class="co"># reset to default</span>

<span class="kw">plot</span>(<span class="kw">st_geometry</span>(counties_spec), <span class="dt">col=</span><span class="kw">adjustcolor</span>(<span class="st">&quot;maroon&quot;</span>, <span class="dt">alpha=</span><span class="fl">0.5</span>), <span class="dt">cex=</span><span class="fl">1.5</span>)
<span class="kw">plot</span>(<span class="kw">st_geometry</span>(rivers_sf), <span class="dt">col=</span><span class="kw">adjustcolor</span>(<span class="st">&quot;blue&quot;</span>, <span class="dt">alpha=</span><span class="fl">0.7</span>), <span class="dt">add=</span>T)
<span class="kw">text</span>(counties_spec<span class="op">$</span>lon, counties_spec<span class="op">$</span>lat, <span class="dt">labels =</span> counties_spec<span class="op">$</span>name)
graphics<span class="op">::</span><span class="kw">title</span>(<span class="st">&quot;Selected CA Counties&quot;</span>)</code></pre></div>
<p><img src="spatial_linepoly_files/figure-html/plot_sf-1.png" width="672" /></p>
<p>Unforunately this map isn’t very good. How can we improve it? Seems it would be nicer to crop the river layer to the counties of interest, or at least center things on that area. Also might be nice to have the labels on top and not obscured by the rivers.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># get range of lat/longs from counties for mapping</span>
mapRange1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">range</span>(<span class="kw">st_coordinates</span>(counties_spec)[,<span class="dv">1</span>]),<span class="kw">range</span>(<span class="kw">st_coordinates</span>(counties_spec)[,<span class="dv">2</span>]))

<span class="kw">plot</span>(<span class="kw">st_geometry</span>(rivers_sf), <span class="dt">col=</span><span class="kw">adjustcolor</span>(<span class="st">&quot;blue&quot;</span>, <span class="dt">alpha=</span><span class="fl">0.7</span>),
     <span class="dt">xlim=</span>mapRange1[<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)], <span class="dt">ylim =</span> mapRange1[<span class="kw">c</span>(<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>)],<span class="dt">axes=</span>T)
<span class="kw">plot</span>(<span class="kw">st_geometry</span>(counties_spec), <span class="dt">col=</span><span class="kw">adjustcolor</span>(<span class="st">&quot;maroon&quot;</span>, <span class="dt">alpha=</span><span class="fl">0.5</span>), <span class="dt">cex=</span><span class="fl">1.5</span>, <span class="dt">add=</span>T)
<span class="kw">text</span>(counties_spec<span class="op">$</span>lon, counties_spec<span class="op">$</span>lat, <span class="dt">labels =</span> counties_spec<span class="op">$</span>name,
     <span class="dt">col=</span><span class="kw">adjustcolor</span>(<span class="st">&quot;white&quot;</span>, <span class="dt">alpha=</span><span class="fl">0.8</span>), <span class="dt">font =</span> <span class="dv">2</span>)
graphics<span class="op">::</span><span class="kw">title</span>(<span class="st">&quot;Selected CA Counties&quot;</span>)</code></pre></div>
<p><img src="spatial_linepoly_files/figure-html/relayering-1.png" width="672" /></p>
<p>That’s a little better…but still not quite what we want. Lots of extra ink going toward stuff that we don’t need (i.e., rivers outside of counties). What about cropping the river layer to our county layer?</p>
</div>
<div id="cropping-with-sf" class="section level3">
<h3>Cropping with <code>sf</code></h3>
<p>Great thing is that <code>sf</code> has some really nice tools for this, just as any GIS program would. Here let’s use <code>st_intersection</code> to crop our river layer to only rivers in the counties of interest.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rivers_crop &lt;-<span class="st"> </span><span class="kw">st_intersection</span>(rivers_sf, counties_spec)</code></pre></div>
<pre><code>## although coordinates are longitude/latitude, st_intersection assumes that they are planar</code></pre>
<pre><code>## Warning: attribute variables are assumed to be spatially constant
## throughout all geometries</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="kw">st_geometry</span>(rivers_crop), <span class="dt">col=</span><span class="st">&quot;blue&quot;</span>) <span class="co"># a quick plot check to make sure it worked</span></code></pre></div>
<p><img src="spatial_linepoly_files/figure-html/crop_sf-1.png" width="672" /></p>
<p>Great, let’s try our plot again.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># try again, let&#39;s switch layer ordering</span>
<span class="kw">plot</span>(<span class="kw">st_geometry</span>(counties_spec), <span class="dt">col=</span><span class="kw">adjustcolor</span>(<span class="st">&quot;maroon&quot;</span>, <span class="dt">alpha=</span><span class="fl">0.2</span>), <span class="dt">cex=</span><span class="fl">1.5</span>, <span class="dt">axes=</span>T)
<span class="kw">plot</span>(<span class="kw">st_geometry</span>(rivers_crop), <span class="dt">col=</span><span class="kw">adjustcolor</span>(<span class="st">&quot;blue&quot;</span>, <span class="dt">alpha=</span><span class="fl">0.7</span>),<span class="dt">add=</span>T)
<span class="kw">plot</span>(<span class="kw">st_geometry</span>(CA), <span class="dt">add=</span>T, <span class="dt">lwd=</span><span class="dv">2</span>)
<span class="kw">text</span>(counties_spec<span class="op">$</span>lon, counties_spec<span class="op">$</span>lat, <span class="dt">labels =</span> counties_spec<span class="op">$</span>name,
     <span class="dt">col=</span><span class="st">&quot;maroon&quot;</span>, <span class="dt">font =</span> <span class="dv">2</span>)
graphics<span class="op">::</span><span class="kw">title</span>(<span class="st">&quot;Selected CA Counties&quot;</span>)</code></pre></div>
<p><img src="spatial_linepoly_files/figure-html/cropRelayer-1.png" width="672" /></p>
<p>Ok! Not bad. What can we improve?</p>
</div>
<div id="ggplot2-and-sf" class="section level3">
<h3><code>ggplot2</code> and <code>sf</code></h3>
<p>Mapping with ggplot2 brings some extra things we can fiddle with. Since these data are all data.frames (<code>sf</code> features), we can use the <code>geom_sf</code> function in the most recent version of <code>ggplot2</code>. I’m showing what happens by limiting the map range, vs. without the <code>coord_sf</code> call.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># not cropped</span>
<span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>CA, <span class="dt">color =</span> <span class="st">&quot;gray30&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">fill=</span><span class="ot">NA</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>counties_spec, <span class="dt">fill =</span> <span class="ot">NA</span>, <span class="dt">show.legend =</span> F, <span class="dt">color=</span><span class="st">&quot;gray50&quot;</span>, <span class="dt">lwd=</span><span class="fl">0.4</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_label_repel</span>(<span class="dt">data=</span>counties_spec, <span class="kw">aes</span>(<span class="dt">x=</span>lon, <span class="dt">y=</span>lat, <span class="dt">label=</span>name)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>()</code></pre></div>
<p><img src="spatial_linepoly_files/figure-html/ggplot_map1-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># with cropped range (to only our selected counties)</span>
<span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>CA, <span class="dt">color =</span> <span class="st">&quot;gray30&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">fill=</span><span class="ot">NA</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>counties_spec, <span class="dt">fill =</span> <span class="ot">NA</span>, <span class="dt">show.legend =</span> F, <span class="dt">color=</span><span class="st">&quot;gray50&quot;</span>, <span class="dt">lwd=</span><span class="fl">0.4</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>rivers_crop, <span class="dt">col=</span><span class="st">&quot;blue&quot;</span>, <span class="dt">alpha=</span><span class="fl">0.8</span>, <span class="dt">size=</span><span class="fl">0.5</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_label_repel</span>(<span class="dt">data=</span>counties_spec, <span class="kw">aes</span>(<span class="dt">x=</span>lon, <span class="dt">y=</span>lat, <span class="dt">label=</span>name)) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_sf</span>(<span class="dt">xlim =</span> mapRange1[<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)], <span class="dt">ylim =</span> mapRange1[<span class="kw">c</span>(<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>)]) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>(<span class="dt">base_family =</span> <span class="st">&quot;Roboto Condensed&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="co"># change to &quot;sans&quot; if this font not available</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Selected CA Counties and Riverlines&quot;</span>)</code></pre></div>
<p><img src="spatial_linepoly_files/figure-html/ggplot_map1-2.png" width="672" /></p>
</div>
</div>
<div id="put-it-all-together" class="section level2">
<h2>Put it All Together</h2>
<ul>
<li>Can you crop to a single county and plot the rivers and county?</li>
<li>How might you make an inset in your map? (hint…see <a href="https://ryanpeek.github.io/2016-09-28-static_maps_in_R/">here</a>)</li>
<li>What about buffering outside of the selected counties by 30 km?</li>
<li>Can you add some points? Try adding a point at <strong>39.4 N and 121.0 W</strong>.</li>
</ul>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
